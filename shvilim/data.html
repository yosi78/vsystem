<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×××’×¨ ××™×“×¢ ×œ××•×¨×•×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
			display: flex;
			flex-direction: column;
			min-height: 90vh;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: 'ğŸ“š';
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Footer Styles */
        .footer {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: auto;
            border-radius: 0 0 20px 20px;
        }
 .footer-name {
            font-size: 1.0em;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }
        
        .footer-name:hover {
            color: #3498db;
            transform: scale(1.05);
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        
        .footer-copyright {
            font-size: 0.8em;
            color: #bdc3c7;
            opacity: 0.8;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
            min-height: 400px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .sub-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .sub-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #333;
        }

        .sub-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .sub-btn.nested {
            background: #e8f4fd;
            border-color: #007bff;
            margin-right: 20px;
            position: relative;
        }

        .sub-btn.nested::before {
            content: 'â””â”€';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            color: #007bff;
            font-weight: bold;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .breadcrumb span {
            color: #007bff;
            font-weight: bold;
        }

        .resource-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .drive-link {
            display: inline-block;
            padding: 15px 30px;
            background: #4285f4;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .drive-link:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .comment-section {
            margin-top: 20px;
        }

        .comment-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .name-input {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
        }

        .comment-input {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            min-height: 80px;
            resize: vertical;
        }

        .send-btn {
            padding: 15px 25px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            align-self: flex-start;
        }

        .send-btn:hover {
            background: #218838;
        }

        .send-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .comments-list {
            background: white;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .comment {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .comment:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: bold;
            color: #333;
        }

        .comment-time {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .comment-text {
            color: #333;
            line-height: 1.4;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
        }

        .admin-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .topic-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .topic-item.nested {
            margin-right: 20px;
            border-right: 3px solid #007bff;
            background: #f0f8ff;
        }

        /* ×¡×’× ×•× ×•×ª ×’×¨×™×¨×” */
        .topic-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .topic-item.drag-over {
            border: 3px dashed #28a745;
            background: #d4edda;
            transform: scale(1.02);
        }

        .drop-zone {
            min-height: 40px;
            border: 2px dashed #28a745;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #28a745;
            margin-top: 10px;
            background: rgba(40, 167, 69, 0.1);
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: rgba(40, 167, 69, 0.2);
            border-color: #155724;
        }

        .drag-handle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: grab;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .drag-handle:hover {
            background: #5a6268;
        }

        .topic-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .add-nested-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .add-nested-btn:hover {
            background: #138496;
        }

        .add-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .add-input {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }

        .add-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            align-self: flex-start;
        }

        .edit-form {
            background: #fff;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .edit-form h4 {
            color: #007bff;
            margin-bottom: 10px;
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .save-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .firebase-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .firebase-setup h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .firebase-setup p {
            color: #856404;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .level-selector {
            margin-bottom: 20px;
        }

        .level-selector select {
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-left: 10px;
            font-size: 1rem;
        }

        .drag-mode-toggle {
            background: #ffc107;
            color: #212529;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .drag-mode-toggle:hover {
            background: #e0a800;
        }

        .drag-mode-toggle.active {
            background: #28a745;
            color: white;
        }

        .drag-instructions {
            background: #e7f3ff;
            border: 1px solid #b3d7ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #0c5460;
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .btn {
                font-size: 1.1rem;
                padding: 15px;
            }
            
            .sub-buttons {
                grid-template-columns: 1fr;
            }

            .comment-form {
                gap: 8px;
            }

            .add-form {
                flex-direction: column;
            }

            .topic-actions {
                flex-direction: column;
                gap: 5px;
            }

            .sub-btn.nested {
                margin-right: 10px;
            }

            .topic-item.nested {
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>×××’×¨ ××™×“×¢ ×œ××•×¨×•×ª</h1>
            <p>version 0.4 <span id="connection-status" class="status-indicator status-disconnected">×× ×•×ª×§</span></p>
        </div>

        <div class="content">
            <!-- ×”×•×“×¢×ª ×”×’×“×¨×ª Firebase -->
            <div class="firebase-setup" id="firebase-setup">
                <h3>ğŸ”§ ×”×’×“×¨×ª Firebase × ×“×¨×©×ª</h3>
                <p>×›×“×™ ×©×”×”×¢×¨×•×ª ×™×™×©××¨×• ×•×™×”×™×• ×–××™× ×•×ª ×œ×›×œ ×”××•×¨×•×ª, ×™×© ×¦×•×¨×š ×‘×”×’×“×¨×” ×§×¦×¨×” ×©×œ Firebase.</p>
                <p>×¢×§×‘×™ ××—×¨×™ ×”×”×•×¨××•×ª ×œ××˜×” ×›×“×™ ×œ×”×¤×¢×™×œ ××ª ×”××¢×¨×›×ª ×‘××œ×•××”.</p>
            </div>

            <!-- ××¡×š ×¨××©×™ -->
            <div id="main-screen" class="screen active">
                <div class="main-buttons" id="main-buttons">
                    <!-- ×”×›×¤×ª×•×¨×™× ×™×ª×•×•×¡×¤×• ×›××Ÿ ×“×™× ××™×ª -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="showAdminLogin()" style="background: #6c757d; font-size: 1rem; padding: 10px 20px;">
                        × ×™×”×•×œ
                    </button>
                </div>
            </div>

            <!-- ××¡×š ×ª×ª×™ × ×•×©××™× -->
            <div id="sub-screen" class="screen">
                <button class="back-btn" onclick="navigateBack()">â† ×—×–×¨×”</button>
                <div class="breadcrumb" id="breadcrumb"></div>
                <h2 id="sub-title"></h2>
                <div class="sub-buttons" id="sub-buttons">
                    <!-- ×ª×ª×™ ×”× ×•×©××™× ×™×ª×•×•×¡×¤×• ×›××Ÿ -->
                </div>
            </div>

            <!-- ××¡×š ××©××‘ -->
            <div id="resource-screen" class="screen">
                <button class="back-btn" onclick="navigateBack()">â† ×—×–×¨×”</button>
                <div class="breadcrumb" id="resource-breadcrumb"></div>
                <h2 id="resource-title"></h2>
                
                <div class="resource-section">
                    <a href="#" id="drive-link" class="drive-link" target="_blank">
                        ğŸ”— ×¤×ª×— ×§×•×‘×¥ ×‘×’×•×’×œ ×“×¨×™×™×‘
                    </a>
					<div id="file-owner-display" style="margin-top: 10px; font-size: 1rem; color: #333;"></div>
                    
                    <div class="comment-section">
                        <h3>×”×¢×¨×•×ª ×•×‘×™×§×•×¨×ª</h3>
                        
                        <div id="comment-error" class="error" style="display: none;"></div>
                        <div id="comment-success" class="success" style="display: none;"></div>
                        
                        <div class="comment-form">
                            <input type="text" class="name-input" id="user-name" placeholder="×”×©× ×©×œ×š (××•×¤×¦×™×•× ×œ×™)">
                            <textarea class="comment-input" id="comment-input" placeholder="×”×›× ×¡×™ ×”×¢×¨×” ××• ×‘×™×§×•×¨×ª..."></textarea>
                            <button class="send-btn" id="send-btn" onclick="addComment()">×©×œ×—</button>
                        </div>
                        
                        <div class="comments-list" id="comments-list">
                            <div class="loading">×˜×•×¢×Ÿ ×”×¢×¨×•×ª...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ××¡×š ×›× ×™×¡×” ×œ×× ×”×œ -->
            <div id="login-screen" class="screen">
                <button class="back-btn" onclick="showMainScreen()">â† ×—×–×¨×”</button>
                <div class="login-form">
                    <h2>×›× ×™×¡×” ×œ×× ×”×œ</h2>
                    <input type="password" class="login-input" id="admin-password" placeholder="×”×›× ×¡ ×¡×™×¡××”">
                    <button class="btn" onclick="adminLogin()">×›× ×™×¡×”</button>
                </div>
            </div>

            <!-- ××¡×š ×× ×”×œ -->
            <div id="admin-screen" class="screen">
                <button class="back-btn" onclick="showMainScreen()">â† ×—×–×¨×”</button>
                <h2>×¤×× ×œ ×× ×”×œ</h2>
                
                <div class="admin-panel">
                    <!-- ××¦×‘ ×’×¨×™×¨×” -->
                    <button class="drag-mode-toggle" id="drag-mode-toggle" onclick="toggleDragMode()">
                        ğŸ”„ ×”×¤×¢×œ ××¦×‘ ×’×¨×™×¨×”
                    </button>
                    
                    <div class="drag-instructions" id="drag-instructions">
                        <strong>ğŸ¯ ××¦×‘ ×’×¨×™×¨×” ×¤×¢×™×œ!</strong><br>
                        â€¢ ×’×¨×•×¨ × ×•×©××™× ×‘×××¦×¢×•×ª ×›×¤×ª×•×¨ ×”"â‹®â‹®"<br>
                        â€¢ ×©×—×¨×¨ ×¢×œ × ×•×©× ××—×¨ ×›×“×™ ×œ×”×–×™×– ×ª×—×ª×™×•<br>
                        â€¢ ×©×—×¨×¨ ×¢×œ ×”××–×•×¨ ×”×™×¨×•×§ ×›×“×™ ×œ×”×–×™×– ×œ×¨××” ×”×¨××©×•× ×”<br>
                        â€¢ ×œ×—×¥ ×©×•×‘ ×¢×œ ×›×¤×ª×•×¨ ×”×’×¨×™×¨×” ×›×“×™ ×œ×¦××ª ××”××¦×‘
                    </div>
			
					<div class="admin-section">
                        <h3>ğŸ” ×©×™× ×•×™ ×¡×™×¡××ª ×× ×”×œ</h3>
                        <div class="password-change-section" style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7;">
                            <div id="password-change-error" class="error" style="display: none;"></div>
                            <div id="password-change-success" class="success" style="display: none;"></div>
                            
                            <div style="display: flex; flex-direction: column; gap: 10px; max-width: 400px;">
                                <input type="password" class="add-input" id="current-password" placeholder="×¡×™×¡××” × ×•×›×—×™×ª" style="margin-bottom: 10px;">
                                <input type="password" class="add-input" id="new-password" placeholder="×¡×™×¡××” ×—×“×©×”" style="margin-bottom: 10px;">
                                <input type="password" class="add-input" id="confirm-password" placeholder="××™××•×“ ×¡×™×¡××” ×—×“×©×”" style="margin-bottom: 15px;">
                                <button class="btn" onclick="changeAdminPassword()" id="change-password-btn" style="background: #dc3545; font-size: 1rem; padding: 12px 20px; align-self: flex-start;">
                                    ×©× ×” ×¡×™×¡××”
                                </button>
                            </div>
                            
                            <div style="margin-top: 15px; font-size: 0.9em; color: #856404;">
                                <strong>×”× ×—×™×•×ª ×œ×¡×™×¡××” ×—×–×§×”:</strong><br>
                                â€¢ ×œ×¤×—×•×ª 6 ×ª×•×•×™×<br>
                                â€¢ ×”×™×× ×¢ ××¡×™×¡×××•×ª ×¤×©×•×˜×•×ª ×›××• "123456" ××• "password"<br>
                                â€¢ ××œ ×ª×©×ª×£ ××ª ×”×¡×™×¡××” ×¢× ××—×¨×™×
                            </div>
                        </div>
                    </div>
		
                    <div class="admin-section">
                        <h3>× ×•×©××™× ×¨××©×™×™×</h3>
                        <div id="main-topics-list">
                            <!-- ×¨×©×™××ª × ×•×©××™× ×¨××©×™×™× -->
                        </div>
                        <div class="add-form">
                            <input type="text" class="add-input" id="new-main-topic" placeholder="× ×•×©× ×—×“×©">
                            <button class="add-btn" onclick="addMainTopic()">×”×•×¡×£</button>
                        </div>
                    </div>

                    <div class="admin-section">
                        <h3>×ª×ª×™ × ×•×©××™×</h3>
                        <div class="level-selector">
                            <label>×‘×—×¨ × ×•×©× ×¨××©×™:</label>
                            <select id="topic-select" class="add-input" style="margin-bottom: 10px;">
                                <option value="">×‘×—×¨ × ×•×©× ×¨××©×™</option>
                            </select>
                        </div>
                        
                        <div class="level-selector" id="parent-selector" style="display: none;">
                            <label>×‘×—×¨ ×ª×ª × ×•×©× ×¢×œ×™×•×Ÿ (××•×¤×¦×™×•× ×œ×™):</label>
                            <select id="parent-select" class="add-input">
                                <option value="">×œ×œ× × ×•×©× ×¢×œ×™×•×Ÿ (×¨××” ×¨××©×•× ×”)</option>
                            </select>
                        </div>
                        
                        <div id="sub-topics-list">
                            <!-- ×¨×©×™××ª ×ª×ª×™ × ×•×©××™× -->
                        </div>
                        <div class="add-form">
                            <input type="text" class="add-input" id="new-sub-topic" placeholder="×ª×ª × ×•×©× ×—×“×©">
                            <input type="text" class="add-input" id="new-drive-link" placeholder="×§×™×©×•×¨ ×œ×’×•×’×œ ×“×¨×™×™×‘ (×¨×§ ×× ×–×” ××¡××š ×¡×•×¤×™)">
							<input type="text" class="add-input" id="new-file-owner" placeholder="×©× ×‘×¢×œ ×”×§×•×‘×¥ (××•×¤×¦×™×•× ×œ×™)">
                            <button class="add-btn" type="button" onclick="addSubTopic()">×”×•×¡×£ ×ª×ª × ×•×©×</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<!-- Footer -->
		<div class="footer">
<a href="mailto:yosiel3@gmail.com?subject=×‘× ×•×’×¢ ×œ××¢×¨×›×ª ×××’×¨ ××™×“×¢&body=×©×œ×•× ×™×•×¡×™," class="footer-name">ByteLogicx</a>
		<div class="footer-copyright">Â© 2023 ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</div>
		</div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
		apiKey: "AIzaSyC3IWkqDjwOLb4tTtgtfgkXdLSri8Voeag",
		authDomain: "data-storage-8c9ca.firebaseapp.com",
		databaseURL: "https://data-storage-8c9ca-default-rtdb.firebaseio.com",
		projectId: "data-storage-8c9ca",
		storageBucket: "data-storage-8c9ca.firebasestorage.app",
		messagingSenderId: "505046082965",
	    appId: "1:505046082965:web:e722ae19e5b5cbbfb2029c",
	    measurementId: "G-Q9HYH3ZWCJ"
	     };

        let database;
        let firebaseInitialized = false;

        // ×¤×•× ×§×¦×™×” ×œ××ª×—×•×œ Firebase
        function initFirebase() {
            try {
                if (typeof firebase === 'undefined') {
                    console.log('Firebase SDK ×œ× × ×˜×¢×Ÿ');
                    return false;
                }

                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                firebaseInitialized = true;
                document.getElementById('firebase-setup').style.display = 'none';
                updateConnectionStatus(true);
                console.log('Firebase ×”×•×’×“×¨ ×‘×”×¦×œ×—×”');
                
                // ×˜×¢×Ÿ × ×ª×•× ×™× ××”×‘×¡×™×¡
                loadDataFromFirebase();
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateConnectionStatus(false);
                return false;
            }
        }
		// ×¤×•× ×§×¦×™×” ×œ×”×¦×¤× ×ª ×¡×™×¡××”
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // ×¤×•× ×§×¦×™×” ×œ×©××™×¨×ª ×¡×™×¡××” ×¨××©×•× ×™×ª
        async function setInitialAdminPassword() {
            if (!firebaseInitialized) {
                console.error('Firebase ×œ× ××—×•×‘×¨ - ×œ× × ×™×ª×Ÿ ×œ×©××•×¨ ×¡×™×¡××”');
                return;
            }
            
            try {
                // ×‘×“×•×§ ×× ×›×‘×¨ ×™×© ×¡×™×¡××”
                const snapshot = await database.ref('adminPassword').once('value');
                if (snapshot.exists()) {
                    console.log('×¡×™×¡××ª ×× ×”×œ ×›×‘×¨ ×§×™×™××ª ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×');
                    return;
                }
                
                // ×”×¦×¤×Ÿ ×•×©××•×¨ ××ª ×”×¡×™×¡××” ×”×§×™×™××ª
                const hashedPassword = await hashPassword('n0987');
                await database.ref('adminPassword').set(hashedPassword);
                console.log('×¡×™×¡××ª ×× ×”×œ × ×©××¨×” ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™× ×‘×”×¦×¤× ×”');
                
            } catch (error) {
                console.error('×©×’×™××” ×‘×©××™×¨×ª ×¡×™×¡××ª ×× ×”×œ:', error);
            }
        }
        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×—×™×‘×•×¨
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connection-status');
            if (connected) {
                statusEl.textContent = '××—×•×‘×¨';
                statusEl.className = 'status-indicator status-connected';
            } else {
                statusEl.textContent = '×œ× ××—×•×‘×¨';
                statusEl.className = 'status-indicator status-disconnected';
            }
        }

        // ×©××™×¨×ª × ×ª×•× ×™× ×‘-Firebase
        async function saveDataToFirebase() {
            if (!firebaseInitialized) {
                console.log('Firebase ×œ× ××•×’×“×¨, ×©×•××¨ ××§×•××™×ª');
                saveDataLocally();
                return;
            }

            try {
                await database.ref('appData').set(appData);
                console.log('× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×” ×‘-Firebase');
                showSuccess('×”×©×™× ×•×™×™× × ×©××¨×• ×‘×”×¦×œ×—×”!');
            } catch (error) {
                console.error('×©×’×™××” ×‘×©××™×¨×” ×‘-Firebase:', error);
                saveDataLocally(); // ×’×™×‘×•×™ ××§×•××™
                showError('×©×’×™××” ×‘×©××™×¨×”. ×”× ×ª×•× ×™× × ×©××¨×• ××§×•××™×ª.');
            }
        }

        // ×˜×¢×™× ×ª × ×ª×•× ×™× ×-Firebase
		function loadDataFromFirebase() {
			if (!firebaseInitialized) {
				loadDataLocally();
				return;
			}

			database.ref('appData').once('value')
				.then((snapshot) => {
					const data = snapshot.val();
					if (data) {
						appData = data;  // ×§×•×“× ×¢×“×›×Ÿ ××ª ×”× ×ª×•× ×™×
						updateExistingData(); // ×•××– ×”×•×¡×£ ×©×“×•×ª ×—×¡×¨×™×
						console.log('× ×ª×•× ×™× × ×˜×¢× ×• ×-Firebase');
					} else {
						saveDataToFirebase();
					}
					renderMainTopics();
					setInitialAdminPassword();
				})
				.catch((error) => {
					console.error('×©×’×™××” ×‘×˜×¢×™× ×” ×-Firebase:', error);
					loadDataLocally();
				});
		}

        // ×©××™×¨×” ××§×•××™×ª ×›×’×™×‘×•×™
        function saveDataLocally() {
            localStorage.setItem('teacherAppData', JSON.stringify(appData));
            console.log('× ×ª×•× ×™× × ×©××¨×• ××§×•××™×ª');
        }

        // ×˜×¢×™× ×” ××§×•××™×ª
		function loadDataLocally() {
			const saved = localStorage.getItem('teacherAppData');
			if (saved) {
				try {
					const loadedData = JSON.parse(saved);
					appData = loadedData;
					updateExistingData(); // ×”×•×¡×£ ××ª ×”×©×•×¨×” ×”×–×•
					console.log('× ×ª×•× ×™× × ×˜×¢× ×• ××§×•××™×ª');
				} catch (e) {
					console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™× ××§×•××™×™×:', e);
				}
			}
			renderMainTopics();
		}

        // ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ×”×¢×¨×”
        window.addCommentToFirebase = async function(resourceId, commentText, userName) {
            if (!firebaseInitialized) {
                throw new Error('Firebase ×œ× ××•×’×“×¨');
            }

            const commentsRef = database.ref(`comments/${resourceId}`);
            await commentsRef.push({
                text: commentText,
                author: userName || '×× ×•× ×™××™',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
        };

        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª ×”×¢×¨×•×ª
        window.loadCommentsFromFirebase = function(resourceId, callback) {
            if (!firebaseInitialized) {
                console.log('Firebase ×œ× ××•×’×“×¨, ××©×ª××© ×‘× ×ª×•× ×™× ××§×•××™×™×');
                callback([]);
                return;
            }

            const commentsRef = database.ref(`comments/${resourceId}`);
            commentsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                const comments = [];
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        comments.push({
                            id: key,
                            ...data[key]
                        });
                    });
                }
                
                comments.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                callback(comments);
            });
        };

        // ××ª×—×•×œ Firebase ×›×©×”×¢××•×“ × ×˜×¢×Ÿ
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                    initFirebase();
                } else {
                    loadDataLocally();
                }
            }, 100);
        });
    </script>

    <script>
        // × ×ª×•× ×™× ×¨××©×™×™× - ×¢× ×ª××™×›×” ×‘×ª×ª×™ × ×•×©××™× ××§×•× × ×™×
        let appData = {
            mainTopics: [
                {
                    id: 1,
                    name: "×™××™ ×—×•×¥",
                    subTopics: [
                        { 
                            id: 1, 
                            name: "×ª×›× ×•×Ÿ ×©× ×ª×™", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        },
                        { 
                            id: 2, 
                            name: "×—×•× ×›×•×ª", 
                            driveLink: "", 
							fileOwner: "",
                            subTopics: [
                                { id: 10, name: "×ª×›× ×•×Ÿ ×œ×—×•×“×© ×¡×¤×˜××‘×¨", driveLink: "", fileOwner: "", subTopics: [] },
                                { id: 11, name: "×ª×›× ×•×Ÿ ×œ×—×•×“×© ××•×§×˜×•×‘×¨", driveLink: "", fileOwner: "", subTopics: [] }
                            ]
                        },
                        { 
                            id: 3, 
                            name: "××“×¨×™×›×™×", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        }
                    ]
                },
                {
                    id: 2,
                    name: "××©×•×œ×©×™×",
                    subTopics: [
                        { 
                            id: 4, 
                            name: "××‘×—× ×™×", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: [
                                { id: 12, name: "××‘×—× ×™ ××ª××˜×™×§×”", driveLink: "", fileOwner: "", subTopics: [] },
                                { id: 13, name: "××‘×—× ×™ ×¢×‘×¨×™×ª", driveLink: "", fileOwner: "", subTopics: [] }
                            ]
                        },
                        { 
                            id: 5, 
                            name: "××©×™××•×ª", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        },
                        { 
                            id: 6, 
                            name: "×¤×¨×•×™×§×˜×™×", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        }
                    ]
                },
                {
                    id: 3,
                    name: "××“×¨×™×›×™×",
                    subTopics: [
                        { 
                            id: 7, 
                            name: "××©××¢×ª", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        },
                        { 
                            id: 8, 
                            name: "××•×˜×™×‘×¦×™×”", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        },
                        { 
                            id: 9, 
                            name: "×ª×§×©×•×¨×ª", 
                            driveLink: "",
							fileOwner: "",
                            subTopics: []
                        }
                    ]
                }
            ]
        };

        let currentMainTopic = null;
        let currentSubTopic = null;
        let currentPath = [];
        let editingMainTopic = null;
        let editingSubTopic = null;
        
        // ××©×ª× ×™ ×’×¨×™×¨×”
        let isDragMode = false;
        let draggedElement = null;
        let draggedData = null;

        // ××ª×—×•×œ ×”××ª×¨
        function initApp() {
			updateExistingData();
            renderMainTopics();
        }

		// ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ×©×“×” fileOwner ×œ× ×ª×•× ×™× ×§×™×™××™×
		function updateExistingData() {
			function addFileOwnerField(subTopics) {
				subTopics.forEach(subTopic => {
					if (!subTopic.hasOwnProperty('fileOwner')) {
						subTopic.fileOwner = '';
					}
					if (subTopic.subTopics && subTopic.subTopics.length > 0) {
						addFileOwnerField(subTopic.subTopics);
					}
				});
			}
			
			appData.mainTopics.forEach(mainTopic => {
				if (mainTopic.subTopics) {
					addFileOwnerField(mainTopic.subTopics);
				}
			});
		}

        // ×”×¦×’×ª ×”× ×•×©××™× ×”×¨××©×™×™×
        function renderMainTopics() {
            const container = document.getElementById('main-buttons');
            container.innerHTML = '';
            
            appData.mainTopics.forEach(topic => {
                const button = document.createElement('button');
                button.className = 'btn';
                button.textContent = topic.name;
                button.onclick = () => showSubTopics(topic);
                container.appendChild(button);
            });
        }

        // ×”×¦×’×ª ×ª×ª×™ × ×•×©××™× - ×¢× ×ª××™×›×” ×‘× ×ª×™×‘
        function showSubTopics(topic, parentPath = []) {
            currentMainTopic = topic;
            currentPath = [...parentPath, topic];
            
            // ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª
            document.getElementById('sub-title').textContent = topic.name;
            
            // ×¢×“×›×•×Ÿ breadcrumb
            updateBreadcrumb();
            
            const container = document.getElementById('sub-buttons');
            container.innerHTML = '';
            
            if (topic.subTopics && topic.subTopics.length > 0) {
                topic.subTopics.forEach(subTopic => {
                    const button = document.createElement('button');
                    
                    // ×‘×“×™×§×” ×× ×–×” ××¡××š ×¡×•×¤×™ ××• ×™×© ×¢×•×“ ×ª×ª×™ × ×•×©××™×
                    if (subTopic.subTopics && subTopic.subTopics.length > 0) {
                        // ×™×© ×¢×•×“ ×ª×ª×™ × ×•×©××™× - ×›×¤×ª×•×¨ ×œ× ×•×•×˜ ×”×œ××”
                        button.className = 'sub-btn';
                        button.textContent = subTopic.name + ' â–º';
                        button.onclick = () => showSubTopics(subTopic, currentPath);
                    } else if (subTopic.driveLink && subTopic.driveLink.trim()) {
                        // ××¡××š ×¡×•×¤×™ - ×›×¤×ª×•×¨ ×œ×¤×ª×™×—×ª ×”××©××‘
                        button.className = 'sub-btn';
                        button.textContent = subTopic.name;
                        button.onclick = () => showResource(subTopic);
                    } else {
                        // ××™×Ÿ ×§×™×©×•×¨ ×•××™×Ÿ ×ª×ª×™ × ×•×©××™× - ×ª×ª × ×•×©× ×¨×™×§
                        button.className = 'sub-btn';
                        button.textContent = subTopic.name + ' (×¨×™×§)';
                        button.style.opacity = '0.6';
                        button.onclick = () => showSubTopics(subTopic, currentPath);
                    }
                    
                    container.appendChild(button);
                });
            } else {
                // ××™×Ÿ ×ª×ª×™ × ×•×©××™×
                const emptyDiv = document.createElement('div');
                emptyDiv.style.textAlign = 'center';
                emptyDiv.style.color = '#6c757d';
                emptyDiv.style.padding = '20px';
                emptyDiv.textContent = '××™×Ÿ ×ª×ª×™ × ×•×©××™× ×¢×“×™×™×Ÿ';
                container.appendChild(emptyDiv);
            }
            
            showScreen('sub-screen');
        }

        // ×¢×“×›×•×Ÿ breadcrumb
        function updateBreadcrumb() {
            const breadcrumbEl = document.getElementById('breadcrumb');
            if (currentPath.length <= 1) {
                breadcrumbEl.style.display = 'none';
                return;
            }
            
            breadcrumbEl.style.display = 'block';
            const pathText = currentPath.map(item => item.name).join(' â† ');
            breadcrumbEl.innerHTML = '××™×§×•×: <span>' + pathText + '</span>';
        }

        // × ×™×•×•×˜ ×—×–×¨×” ×—×›×
        function navigateBack() {
            if (currentPath.length > 1) {
                // ×—×–×¨×” ×œ×¨××” ×”×§×•×“××ª
                currentPath.pop();
                const parentTopic = currentPath[currentPath.length - 1];
                showSubTopics(parentTopic, currentPath.slice(0, -1));
            } else {
                // ×—×–×¨×” ×œ××¡×š ×”×¨××©×™
                showMainScreen();
            }
        }

        // ×”×¦×’×ª ××©××‘
        function showResource(subTopic) {
            currentSubTopic = subTopic;
            document.getElementById('resource-title').textContent = subTopic.name;
            document.getElementById('drive-link').href = subTopic.driveLink;
            
			const fileOwnerDisplay = document.getElementById('file-owner-display');
			if (subTopic.fileOwner && subTopic.fileOwner.trim()) {
				fileOwnerDisplay.innerHTML = 'ğŸ‘¤ <strong>×‘×¢×œ ×”×§×•×‘×¥:</strong> ' + subTopic.fileOwner;
				fileOwnerDisplay.style.display = 'block';
			} else {
				fileOwnerDisplay.style.display = 'none';
			}

            // ×¢×“×›×•×Ÿ breadcrumb ×œ××©××‘
            const resourceBreadcrumb = document.getElementById('resource-breadcrumb');
            const fullPath = [...currentPath, subTopic];
            const pathText = fullPath.map(item => item.name).join(' â† ');
            resourceBreadcrumb.innerHTML = '××™×§×•×: <span>' + pathText + '</span>';
            
            loadResourceComments(subTopic.id);
            showScreen('resource-screen');
        }

        // ×”×•×¡×¤×ª ×”×¢×¨×”
        async function addComment() {
            const commentInput = document.getElementById('comment-input');
            const nameInput = document.getElementById('user-name');
            const sendBtn = document.getElementById('send-btn');
            const errorDiv = document.getElementById('comment-error');
            const successDiv = document.getElementById('comment-success');
            
            const commentText = commentInput.value.trim();
            const userName = nameInput.value.trim();
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            if (!commentText) {
                showError('×× × ×”×›× ×¡×™ ×”×¢×¨×”');
                return;
            }
            
            if (!currentSubTopic) {
                showError('×©×’×™××”: ×œ× × ×‘×—×¨ × ×•×©×');
                return;
            }
            
            sendBtn.disabled = true;
            sendBtn.textContent = '×©×•×œ×—...';
            
            try {
                if (firebaseInitialized && window.addCommentToFirebase) {
                    await window.addCommentToFirebase(currentSubTopic.id, commentText, userName);
                    commentInput.value = '';
                    nameInput.value = '';
                    showSuccess('×”×”×¢×¨×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!');
                } else {
                    addCommentLocally(currentSubTopic.id, commentText, userName);
                    commentInput.value = '';
                    nameInput.value = '';
                    showSuccess('×”×”×¢×¨×” × ×©××¨×” ××§×•××™×ª (Firebase ×œ× ××•×’×“×¨)');
                }
            } catch (error) {
                console.error('Error adding comment:', error);
                showError('×©×’×™××” ×‘×©×œ×™×—×ª ×”×”×¢×¨×”. ×× × × ×¡×™ ×©×•×‘.');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = '×©×œ×—';
            }
        }

        // ×©××™×¨×” ××§×•××™×ª ×›×’×™×‘×•×™
        let localComments = {};

        function addCommentLocally(resourceId, commentText, userName) {
            if (!localComments[resourceId]) {
                localComments[resourceId] = [];
            }
            
            localComments[resourceId].unshift({
                text: commentText,
                author: userName || '×× ×•× ×™××™',
                timestamp: Date.now()
            });
            
            localStorage.setItem('teacherComments', JSON.stringify(localComments));
            loadResourceComments(resourceId);
        }

        function loadLocalComments() {
            const saved = localStorage.getItem('teacherComments');
            if (saved) {
                try {
                    localComments = JSON.parse(saved);
                } catch (e) {
                    localComments = {};
                }
            }
        }

        // ×˜×¢×™× ×ª ×”×¢×¨×•×ª ×œ××©××‘
        function loadResourceComments(resourceId) {
            const container = document.getElementById('comments-list');
            container.innerHTML = '<div class="loading">×˜×•×¢×Ÿ ×”×¢×¨×•×ª...</div>';
            
            if (window.loadCommentsFromFirebase) {
                window.loadCommentsFromFirebase(resourceId, (comments) => {
                    displayComments(comments);
                });
            } else {
                setTimeout(() => {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">××¢×¨×›×ª ×”×”×¢×¨×•×ª ×œ× ××•×’×“×¨×ª</p>';
                }, 1000);
            }
        }

        // ×”×¦×’×ª ×”×¢×¨×•×ª
        function displayComments(comments) {
            const container = document.getElementById('comments-list');
            container.innerHTML = '';
            
            if (comments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">××™×Ÿ ×”×¢×¨×•×ª ×¢×“×™×™×Ÿ</p>';
                return;
            }
            
            comments.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                
                const timestamp = comment.timestamp ? 
                    new Date(comment.timestamp).toLocaleString('he-IL') : 
                    '×–××Ÿ ×œ× ×™×“×•×¢';
                
                commentDiv.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${comment.author || '×× ×•× ×™××™'}</span>
                        <span class="comment-time">${timestamp}</span>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                `;
                container.appendChild(commentDiv);
            });
        }

        // ×”×¦×’×ª ×”×•×“×¢×ª ×©×’×™××”
        function showError(message) {
            const errorDiv = document.getElementById('comment-error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            } else {
                alert(message);
            }
        }

        // ×”×¦×’×ª ×”×•×“×¢×ª ×”×¦×œ×—×”
        function showSuccess(message) {
            const successDiv = document.getElementById('comment-success');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            } else {
                console.log('×”×¦×œ×—×”: ' + message);
            }
        }

        // ××¢×‘×¨ ×‘×™×Ÿ ××¡×›×™×
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showMainScreen() {
            currentPath = [];
            showScreen('main-screen');
        }

        function showSubScreen() {
            showScreen('sub-screen');
        }

        function showAdminLogin() {
            showScreen('login-screen');
        }

        // ×›× ×™×¡×ª ×× ×”×œ
        async function adminLogin() {
    const password = document.getElementById('admin-password').value;
    const loginBtn = document.querySelector('#login-screen .btn');
    
    if (!password.trim()) {
        alert('×× × ×”×›× ×¡ ×¡×™×¡××”');
        return;
    }
    
    loginBtn.disabled = true;
    loginBtn.textContent = '×‘×•×“×§...';
    
    try {
        if (!firebaseInitialized) {
            alert('×©×’×™××”: ××¢×¨×›×ª ×œ× ××—×•×‘×¨×ª ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×');
            return;
        }
        
        // ×§×‘×œ ××ª ×”×¡×™×¡××” ×”××•×¦×¤× ×ª ××”×‘×¡×™×¡
        const snapshot = await database.ref('adminPassword').once('value');
        if (!snapshot.exists()) {
            alert('×©×’×™××”: ×œ× × ××¦××” ×¡×™×¡××ª ×× ×”×œ');
            return;
        }
        
        const storedHash = snapshot.val();
        const enteredHash = await hashPassword(password);
        
        if (storedHash === enteredHash) {
            document.getElementById('admin-password').value = '';
            showAdminPanel();
        } else {
            alert('×¡×™×¡××” ×©×’×•×™×”');
        }
        
    } catch (error) {
        console.error('×©×’×™××” ×‘×‘×“×™×§×ª ×¡×™×¡××”:', error);
        alert('×©×’×™××” ×‘×‘×“×™×§×ª ×¡×™×¡××”');
    } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = '×›× ×™×¡×”';
    }
}

        function showAdminPanel() {
            renderAdminPanel();
            showScreen('admin-screen');
        }

        // ×¤×•× ×§×¦×™×•×ª ×’×¨×™×¨×”
        function toggleDragMode() {
            isDragMode = !isDragMode;
            const toggleBtn = document.getElementById('drag-mode-toggle');
            const instructions = document.getElementById('drag-instructions');
            
            if (isDragMode) {
                toggleBtn.classList.add('active');
                toggleBtn.innerHTML = 'ğŸ”’ ×¦× ×××¦×‘ ×’×¨×™×¨×”';
                instructions.style.display = 'block';
            } else {
                toggleBtn.classList.remove('active');
                toggleBtn.innerHTML = 'ğŸ”„ ×”×¤×¢×œ ××¦×‘ ×’×¨×™×¨×”';
                instructions.style.display = 'none';
            }
            
            renderSubTopics(); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××” ×¢×/×‘×œ×™ ×›×¤×ª×•×¨×™ ×’×¨×™×¨×”
        }

        function setupDropZone(element, targetData) {
            element.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (draggedElement && draggedElement !== element) {
                    element.classList.add('drag-over');
                }
            });
            
            element.addEventListener('dragleave', (e) => {
                element.classList.remove('drag-over');
            });
            
            element.addEventListener('drop', (e) => {
                e.preventDefault();
                element.classList.remove('drag-over');
                
                if (!draggedData) return;
                
                const { subTopicId: draggedId, mainTopicId: draggedMainId } = draggedData;
                const { subTopicId: targetId, mainTopicId: targetMainId, isNested } = targetData;
                
                if (draggedId === targetId) return; // ×œ× × ×™×ª×Ÿ ×œ×”×–×™×– ×œ×¢×¦××•
                
                moveSubTopic(draggedId, draggedMainId, targetId, targetMainId, isNested);
            });
        }

        function moveSubTopic(draggedId, draggedMainId, targetId, targetMainId, isNested) {
            // ××¦× ×•××¡×™×¨ ××ª ×”× ×•×©× ×”× ×’×¨×¨
            const draggedTopic = removeSubTopicById(draggedMainId, draggedId);
            if (!draggedTopic) {
                showError('×©×’×™××”: ×œ× × ×™×ª×Ÿ ×œ××¦×•× ××ª ×”× ×•×©× ×”× ×’×¨×¨');
                return;
            }
            
            // ×”×•×¡×£ ×œ×™×™×¢×“ ×”×—×“×©
            if (targetId && targetMainId) {
                // ×”×–×—×” ×ª×—×ª × ×•×©× ×§×™×™×
                if (isNested) {
                    addSubTopicUnder(targetMainId, targetId, draggedTopic);
                } else {
                    addSubTopicAfter(targetMainId, targetId, draggedTopic);
                }
            } else {
                // ×”×–×—×” ×œ×¨××” ×”×¨××©×•× ×” ×©×œ × ×•×©× ×¨××©×™
                const mainTopic = appData.mainTopics.find(t => t.id === targetMainId);
                if (mainTopic) {
                    mainTopic.subTopics.push(draggedTopic);
                }
            }
            
            saveDataToFirebase();
            renderParentSelect();
            renderSubTopics();
            showSuccess('×”× ×•×©× ×”×•×¢×‘×¨ ×‘×”×¦×œ×—×”!');
        }

        function removeSubTopicById(mainTopicId, subTopicId) {
            const mainTopic = appData.mainTopics.find(t => t.id === mainTopicId);
            if (!mainTopic) return null;
            
            function removeRecursively(subTopics) {
                for (let i = 0; i < subTopics.length; i++) {
                    if (subTopics[i].id === subTopicId) {
                        return subTopics.splice(i, 1)[0];
                    }
                    if (subTopics[i].subTopics) {
                        const found = removeRecursively(subTopics[i].subTopics);
                        if (found) return found;
                    }
                }
                return null;
            }
            
            return removeRecursively(mainTopic.subTopics);
        }

        function addSubTopicUnder(mainTopicId, parentId, newSubTopic) {
            const mainTopic = appData.mainTopics.find(t => t.id === mainTopicId);
            if (!mainTopic) return;
            
            const parentSubTopic = findSubTopicById(mainTopic.subTopics, parentId);
            if (parentSubTopic) {
                if (!parentSubTopic.subTopics) {
                    parentSubTopic.subTopics = [];
                }
                parentSubTopic.subTopics.push(newSubTopic);
            }
        }

        // ×¢××•×“ ×× ×”×œ
        function renderAdminPanel() {
            renderMainTopicsAdmin();
            renderTopicSelect();
            renderSubTopics();
        }

        function renderMainTopicsAdmin() {
            const mainTopicsList = document.getElementById('main-topics-list');
            mainTopicsList.innerHTML = '';
            
            appData.mainTopics.forEach(topic => {
                if (editingMainTopic && editingMainTopic.id === topic.id) {
                    const editDiv = document.createElement('div');
                    editDiv.className = 'edit-form';
                    editDiv.innerHTML = `
                        <h4>×¢×¨×™×›×ª × ×•×©× ×¨××©×™</h4>
                        <input type="text" class="add-input" id="edit-main-topic-${topic.id}" value="${topic.name}">
                        <div class="edit-actions">
                            <button class="save-btn" onclick="saveMainTopic(${topic.id})">×©××•×¨</button>
                            <button class="cancel-btn" onclick="cancelEditMainTopic()">×‘×™×˜×•×œ</button>
                        </div>
                    `;
                    mainTopicsList.appendChild(editDiv);
                } else {
                    const topicDiv = document.createElement('div');
                    topicDiv.className = 'topic-item';
                    topicDiv.innerHTML = `
                        <span>${topic.name}</span>
                        <div class="topic-actions">
                            <button class="edit-btn" onclick="editMainTopic(${topic.id})">×¢×¨×•×š</button>
                            <button class="delete-btn" onclick="deleteMainTopic(${topic.id})">××—×§</button>
                        </div>
                    `;
                    mainTopicsList.appendChild(topicDiv);
                }
            });
        }

        function renderTopicSelect() {
            const topicSelect = document.getElementById('topic-select');
            topicSelect.innerHTML = '<option value="">×‘×—×¨ × ×•×©× ×¨××©×™</option>';
            
            appData.mainTopics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic.id;
                option.textContent = topic.name;
                topicSelect.appendChild(option);
            });

            topicSelect.onchange = () => {
                renderParentSelect();
                renderSubTopics();
            };
        }

        // ×¨× ×“×•×¨ ×‘×—×™×¨×ª × ×•×©× ×¢×œ×™×•×Ÿ
        function renderParentSelect() {
            const topicSelect = document.getElementById('topic-select');
            const parentSelect = document.getElementById('parent-select');
            const parentSelector = document.getElementById('parent-selector');
            
            const selectedTopicId = topicSelect.value;
            
            if (!selectedTopicId) {
                parentSelector.style.display = 'none';
                return;
            }
            
            parentSelector.style.display = 'block';
            parentSelect.innerHTML = '<option value="">×œ×œ× × ×•×©× ×¢×œ×™×•×Ÿ (×¨××” ×¨××©×•× ×”)</option>';
            
            const topic = appData.mainTopics.find(t => t.id == selectedTopicId);
            if (topic && topic.subTopics) {
                populateParentOptions(topic.subTopics, parentSelect, '');
            }
            
            parentSelect.onchange = renderSubTopics;
        }

        // ×¤×•× ×§×¦×™×” ×¨×§×•×¨×¡×™×‘×™×ª ×œ××™×œ×•×™ ××•×¤×¦×™×•×ª × ×•×©× ×¢×œ×™×•×Ÿ
        function populateParentOptions(subTopics, selectElement, prefix) {
            subTopics.forEach(subTopic => {
                const option = document.createElement('option');
                option.value = subTopic.id;
                option.textContent = prefix + subTopic.name;
                selectElement.appendChild(option);
                
                if (subTopic.subTopics && subTopic.subTopics.length > 0) {
                    populateParentOptions(subTopic.subTopics, selectElement, prefix + '  â””â”€ ');
                }
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ××¦×™××ª ×ª×ª × ×•×©× ×œ×¤×™ ID
        function findSubTopicById(subTopics, id) {
            for (let subTopic of subTopics) {
                if (subTopic.id == id) {
                    return subTopic;
                }
                if (subTopic.subTopics) {
                    const found = findSubTopicById(subTopic.subTopics, id);
                    if (found) return found;
                }
            }
            return null;
        }

        // ×¤×•× ×§×¦×™×” ×œ××¦×™××ª ×ª×ª × ×•×©× ×•×”×•×¨×” ×©×œ×•
        function findSubTopicWithParent(subTopics, id, parent = null) {
            for (let subTopic of subTopics) {
                if (subTopic.id == id) {
                    return { subTopic, parent };
                }
                if (subTopic.subTopics) {
                    const found = findSubTopicWithParent(subTopic.subTopics, id, subTopic);
                    if (found) return found;
                }
            }
            return null;
        }

        function renderSubTopics() {
            const topicSelect = document.getElementById('topic-select');
            const parentSelect = document.getElementById('parent-select');
            const subTopicsList = document.getElementById('sub-topics-list');
            subTopicsList.innerHTML = '';
            
            const selectedTopicId = topicSelect.value;
            if (!selectedTopicId) return;
            
            const topic = appData.mainTopics.find(t => t.id == selectedTopicId);
            if (!topic) return;
            
            const parentId = parentSelect.value;
            let targetSubTopics;
            
            if (parentId) {
                const parentSubTopic = findSubTopicById(topic.subTopics, parentId);
                targetSubTopics = parentSubTopic ? parentSubTopic.subTopics : [];
            } else {
                targetSubTopics = topic.subTopics;
            }
            
            if (targetSubTopics) {
                renderSubTopicsList(targetSubTopics, subTopicsList, topic.id, 0);
            }
            
            // ×”×•×¡×£ ××–×•×¨ ×”×˜×œ×” ×›×œ×œ×™ ×‘××¦×‘ ×’×¨×™×¨×”
            if (isDragMode && targetSubTopics.length > 0) {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.textContent = '×©×—×¨×¨ ×›××Ÿ ×›×“×™ ×œ×”×•×¡×™×£ ×œ×¨××” ×”×¨××©×•× ×”';
                
                setupDropZone(dropZone, { 
                    subTopicId: null, 
                    mainTopicId: parseInt(selectedTopicId), 
                    isNested: false 
                });
                
                subTopicsList.appendChild(dropZone);
            }
        }

        function renderSubTopicsList(subTopics, container, mainTopicId, level = 0) {
            subTopics.forEach(subTopic => {
                if (editingSubTopic && editingSubTopic.id === subTopic.id) {
                    const editDiv = document.createElement('div');
                    editDiv.className = 'edit-form';
                    if (level > 0) editDiv.className += ' nested';
                    editDiv.innerHTML = `
                        <h4>×¢×¨×™×›×ª ×ª×ª × ×•×©×</h4>
                        <input type="text" class="add-input" id="edit-sub-topic-name-${subTopic.id}" value="${subTopic.name}" placeholder="×©× ×ª×ª × ×•×©×">
                        <input type="text" class="add-input" id="edit-sub-topic-link-${subTopic.id}" value="${subTopic.driveLink || ''}" placeholder="×§×™×©×•×¨ ×’×•×’×œ ×“×¨×™×™×‘ (××•×¤×¦×™×•× ×œ×™)">
						<input type="text" class="add-input" id="edit-sub-topic-owner-${subTopic.id}" value="${subTopic.fileOwner || ''}" placeholder="×©× ×‘×¢×œ ×”×§×•×‘×¥ (××•×¤×¦×™×•× ×œ×™)">
                        <div class="edit-actions">
                            <button class="save-btn" onclick="saveSubTopic(${mainTopicId}, ${subTopic.id})">×©××•×¨</button>
                            <button class="cancel-btn" onclick="cancelEditSubTopic()">×‘×™×˜×•×œ</button>
                        </div>
                    `;
                    container.appendChild(editDiv);
                } else {
                    const subTopicDiv = document.createElement('div');
                    subTopicDiv.className = 'topic-item';
                    if (level > 0) subTopicDiv.className += ' nested';
                    
                    const hasSubTopics = subTopic.subTopics && subTopic.subTopics.length > 0;
                    const hasLink = subTopic.driveLink && subTopic.driveLink.trim();
                    
                    let statusText = '';
                    if (hasSubTopics && hasLink) {
                        statusText = ' <span style="color: #28a745;">(×§×˜×’×•×¨×™×” + ××¡××š)</span>';
                    } else if (hasSubTopics) {
                        statusText = ' <span style="color: #007bff;">(×§×˜×’×•×¨×™×”)</span>';
                    } else if (hasLink) {
                        statusText = ' <span style="color: #17a2b8;">(××¡××š)</span>';
                    } else {
                        statusText = ' <span style="color: #6c757d;">(×¨×™×§)</span>';
                    }
                    
                    subTopicDiv.innerHTML = `
                        <div>
                            <strong>${subTopic.name}</strong>${statusText}
                            ${hasLink ? '<br><small style="color: #007bff;">ğŸ”— ' + subTopic.driveLink + '</small>' + (subTopic.fileOwner ? '<br><small style="color: #28a745;">ğŸ‘¤ ' + subTopic.fileOwner + '</small>' : '') : ''}
                            ${hasSubTopics ? '<br><small style="color: #28a745;">ğŸ“ ' + subTopic.subTopics.length + ' ×ª×ª×™ × ×•×©××™×</small>' : ''}
                        </div>
                        <div class="topic-actions">
                            <button class="add-nested-btn" onclick="addNestedSubTopic(${subTopic.id})" title="×”×•×¡×£ ×ª×ª × ×•×©× ×ª×—×ª ${subTopic.name}">×”×•×¡×£ ×ª×—×ª</button>
                            <button class="edit-btn" onclick="editSubTopic(${subTopic.id})" title="×¢×¨×•×š ${subTopic.name}">×¢×¨×•×š</button>
                            <button class="delete-btn" onclick="deleteSubTopic(${mainTopicId}, ${subTopic.id})" title="××—×§ ${subTopic.name}">××—×§</button>
                        </div>
                    `;
                    container.appendChild(subTopicDiv);
                    
                    // ×”×•×¡×£ ×›×¤×ª×•×¨ ×’×¨×™×¨×” ×‘××¦×‘ ×’×¨×™×¨×”
                    if (isDragMode) {
                        const dragHandle = document.createElement('button');
                        dragHandle.className = 'drag-handle';
                        dragHandle.innerHTML = 'â‹®â‹®';
                        dragHandle.title = '×’×¨×•×¨ ×œ×©×™× ×•×™ ××™×§×•×';
                        dragHandle.draggable = true;
                        
                        // ×”×•×¡×£ ××ª ×›×¤×ª×•×¨ ×”×’×¨×™×¨×” ×œ×ª×—×™×œ×ª ×”×¤×¢×•×œ×•×ª
                        const actionsDiv = subTopicDiv.querySelector('.topic-actions');
                        actionsDiv.insertBefore(dragHandle, actionsDiv.firstChild);
                        
                        // ×”×’×“×¨ ××™×¨×•×¢×™ ×’×¨×™×¨×”
                        dragHandle.addEventListener('dragstart', (e) => {
                            draggedData = { subTopicId: subTopic.id, mainTopicId: mainTopicId };
                            draggedElement = subTopicDiv;
                            draggedElement.classList.add('dragging');
                            e.dataTransfer.setData('text/plain', '');
                        });
                        
                        dragHandle.addEventListener('dragend', (e) => {
                            if (draggedElement) {
                                draggedElement.classList.remove('dragging');
                            }
                            document.querySelectorAll('.topic-item, .drop-zone').forEach(item => {
                                item.classList.remove('drag-over');
                            });
                            draggedElement = null;
                            draggedData = null;
                        });
                        
                        // ×”×’×“×¨ ××–×•×¨ ×”×˜×œ×”
                        setupDropZone(subTopicDiv, { 
                            subTopicId: subTopic.id, 
                            mainTopicId: mainTopicId, 
                            isNested: true 
                        });
                    }
                    
                    // ×¨× ×“×•×¨ ×ª×ª×™ × ×•×©××™× ××§×•× × ×™×
                    if (hasSubTopics) {
                        renderSubTopicsList(subTopic.subTopics, container, mainTopicId, level + 1);
                    }
                }
            });
        }

        // ×¤×•× ×§×¦×™×•×ª ×¢×¨×™×›×” ×œ× ×•×©××™× ×¨××©×™×™×
        function editMainTopic(topicId) {
            const topic = appData.mainTopics.find(t => t.id === topicId);
            editingMainTopic = topic;
            renderMainTopicsAdmin();
        }

        function saveMainTopic(topicId) {
            const newName = document.getElementById(`edit-main-topic-${topicId}`).value.trim();
            if (newName) {
                const topic = appData.mainTopics.find(t => t.id === topicId);
                topic.name = newName;
                editingMainTopic = null;
                saveDataToFirebase();
                renderMainTopics();
                renderAdminPanel();
            }
        }

        function cancelEditMainTopic() {
            editingMainTopic = null;
            renderMainTopicsAdmin();
        }

        // ×¤×•× ×§×¦×™×•×ª ×¢×¨×™×›×” ×œ×ª×ª×™ × ×•×©××™×
        function editSubTopic(subTopicId) {
            const topicSelect = document.getElementById('topic-select');
            const selectedTopicId = topicSelect.value;
            const topic = appData.mainTopics.find(t => t.id == selectedTopicId);
            
            if (topic) {
                const subTopic = findSubTopicById(topic.subTopics, subTopicId);
                editingSubTopic = subTopic;
                renderSubTopics();
            }
        }

        function saveSubTopic(topicId, subTopicId) {
            const newName = document.getElementById(`edit-sub-topic-name-${subTopicId}`).value.trim();
            const newLink = document.getElementById(`edit-sub-topic-link-${subTopicId}`).value.trim();
			const newOwner = document.getElementById(`edit-sub-topic-owner-${subTopicId}`).value.trim();
            
            if (newName) {
                const topic = appData.mainTopics.find(t => t.id === topicId);
                const subTopic = findSubTopicById(topic.subTopics, subTopicId);
                
                if (subTopic) {
                    subTopic.name = newName;
                    subTopic.driveLink = newLink;
					subTopic.fileOwner = newOwner;
                    editingSubTopic = null;
                    
                    saveDataToFirebase();
                    renderParentSelect();
                    renderSubTopics();
                    showSuccess('×ª×ª ×”× ×•×©× ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!');
                }
            } else {
                showError('×©× ×ª×ª ×”× ×•×©× ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×¨×™×§');
            }
        }

        function cancelEditSubTopic() {
            editingSubTopic = null;
            renderSubTopics();
        }

        // ×”×•×¡×¤×ª × ×•×©× ×¨××©×™
        function addMainTopic() {
            const input = document.getElementById('new-main-topic');
            const name = input.value.trim();
            
            if (name) {
                const newId = Math.max(...appData.mainTopics.map(t => t.id), 0) + 1;
                appData.mainTopics.push({
                    id: newId,
                    name: name,
                    subTopics: []
                });
                
                input.value = '';
                saveDataToFirebase();
                renderMainTopics();
                renderAdminPanel();
                alert('× ×•×©× ×¨××©×™ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
            } else {
                alert('×× × ×”×›× ×¡ ×©× ×œ× ×•×©×');
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ××¦×™××ª ×”ID ×”×’×‘×•×” ×‘×™×•×ª×¨
        function getMaxSubTopicId() {
            let maxId = 0;
            
            function searchInSubTopics(subTopics) {
                subTopics.forEach(subTopic => {
                    if (subTopic.id > maxId) {
                        maxId = subTopic.id;
                    }
                    if (subTopic.subTopics) {
                        searchInSubTopics(subTopic.subTopics);
                    }
                });
            }
            
            appData.mainTopics.forEach(topic => {
                if (topic.subTopics) {
                    searchInSubTopics(topic.subTopics);
                }
            });
            
            return maxId;
        }

        // ×”×•×¡×¤×ª ×ª×ª × ×•×©×
        function addSubTopic() {
            try {
                const topicSelect = document.getElementById('topic-select');
                const parentSelect = document.getElementById('parent-select');
                const nameInput = document.getElementById('new-sub-topic');
                const linkInput = document.getElementById('new-drive-link');
				const ownerInput = document.getElementById('new-file-owner');
                
                const topicId = parseInt(topicSelect.value);
                const parentId = parentSelect.value ? parseInt(parentSelect.value) : null;
                const name = nameInput.value.trim();
                const driveLink = linkInput.value.trim();
				const fileOwner = ownerInput.value.trim();
                
                if (!topicId || isNaN(topicId)) {
                    alert('×× × ×‘×—×¨ × ×•×©× ×¨××©×™');
                    return;
                }
                
                if (!name) {
                    alert('×× × ×”×›× ×¡ ×©× ×œ×ª×ª × ×•×©×');
                    nameInput.focus();
                    return;
                }
                
                const topic = appData.mainTopics.find(t => t.id === topicId);
                if (!topic) {
                    alert('×©×’×™××”: × ×•×©× ×œ× × ××¦×');
                    return;
                }
                
                if (!topic.subTopics) {
                    topic.subTopics = [];
                }
                
                const newId = getMaxSubTopicId() + 1;
                
                const newSubTopic = {
                    id: newId,
                    name: name,
                    driveLink: driveLink || '',
					fileOwner: fileOwner || '',
                    subTopics: []
                };
                
                // ×”×•×¡×¤×” ×œ××§×•× ×”× ×›×•×Ÿ
                if (parentId) {
                    const parentSubTopic = findSubTopicById(topic.subTopics, parentId);
                    if (parentSubTopic) {
                        if (!parentSubTopic.subTopics) {
                            parentSubTopic.subTopics = [];
                        }
                        parentSubTopic.subTopics.push(newSubTopic);
                    }
                } else {
                    topic.subTopics.push(newSubTopic);
                }
                
                nameInput.value = '';
                linkInput.value = '';
				ownerInput.value = '';
                
                saveDataToFirebase();
                renderParentSelect();
                renderSubTopics();
                
                alert('×ª×ª × ×•×©× × ×•×¡×£ ×‘×”×¦×œ×—×”!');
                
            } catch (error) {
                console.error('Error in addSubTopic:', error);
                alert('×©×’×™××”: ' + error.message);
            }
        }

        // ×”×•×¡×¤×ª ×ª×ª × ×•×©× ××§×•× ×Ÿ
        function addNestedSubTopic(parentId) {
            const topicSelect = document.getElementById('topic-select');
            const selectedTopicId = topicSelect.value;
            
            if (!selectedTopicId) {
                alert('×× × ×‘×—×¨ × ×•×©× ×¨××©×™');
                return;
            }
            
            // ××™×œ×•×™ ××•×˜×•××˜×™ ×©×œ ×”× ×•×©× ×”×¢×œ×™×•×Ÿ
            const parentSelect = document.getElementById('parent-select');
            parentSelect.value = parentId;
            
            // ××™×§×•×“ ×‘×©×“×” ×”×©×
            document.getElementById('new-sub-topic').focus();
            
            const parentSubTopic = findSubTopicById(appData.mainTopics.find(t => t.id == selectedTopicId).subTopics, parentId);
            if (parentSubTopic) {
                showSuccess('×›×¢×ª ×ª×•×›×œ ×œ×”×•×¡×™×£ ×ª×ª × ×•×©× ×ª×—×ª "' + parentSubTopic.name + '"');
            }
        }

        // ××—×™×§×ª × ×•×©× ×¨××©×™
        function deleteMainTopic(topicId) {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”× ×•×©×? ×›×œ ×ª×ª×™ ×”× ×•×©××™× ×™×™××—×§×• ×’× ×›×Ÿ.')) {
                appData.mainTopics = appData.mainTopics.filter(t => t.id !== topicId);
                saveDataToFirebase();
                renderMainTopics();
                renderAdminPanel();
            }
        }

        // ××—×™×§×ª ×ª×ª × ×•×©×
        function deleteSubTopic(topicId, subTopicId) {
            const topic = appData.mainTopics.find(t => t.id === topicId);
            if (!topic) return;
            
            const result = findSubTopicWithParent(topic.subTopics, subTopicId);
            if (!result) return;
            
            const { subTopic, parent } = result;
            const hasSubTopics = subTopic.subTopics && subTopic.subTopics.length > 0;
            
            let confirmMessage = `×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${subTopic.name}"?`;
            if (hasSubTopics) {
                confirmMessage += `\n\n×©×™× ×œ×‘: ×”× ×•×©× ×”×–×” ××›×™×œ ${subTopic.subTopics.length} ×ª×ª×™ × ×•×©××™× ×©×’× ×™×™××—×§×•!`;
            }
            
            if (confirm(confirmMessage)) {
                if (parent) {
                    // ××—×™×§×” ××ª×•×š ×”×•×¨×”
                    parent.subTopics = parent.subTopics.filter(st => st.id !== subTopicId);
                } else {
                    // ××—×™×§×” ××”×¨××” ×”×¨××©×•× ×”
                    topic.subTopics = topic.subTopics.filter(st => st.id !== subTopicId);
                }
                
                saveDataToFirebase();
                renderParentSelect();
                renderSubTopics();
                showSuccess(`"${subTopic.name}" × ××—×§ ×‘×”×¦×œ×—×”!`);
            }
        }

        // ××™×¨×•×¢×™ ××§×œ×“×ª - ××ª×•×§×Ÿ
        document.addEventListener('DOMContentLoaded', function() {
            // Enter ×‘×©×“×” ×”×¢×¨×”
            document.getElementById('comment-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addComment();
                }
            });

            // Enter ×‘×©× ××©×ª××©
            document.getElementById('user-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('comment-input').focus();
                }
            });

            // Enter ×‘×”×•×¡×¤×ª × ×•×©× ×¨××©×™
            document.getElementById('new-main-topic').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addMainTopic();
                }
            });

            // Enter ×‘×”×•×¡×¤×ª ×ª×ª × ×•×©×
            document.getElementById('new-sub-topic').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('new-drive-link').focus();
                }
            });

            // Enter ×‘×§×™×©×•×¨ ×’×•×’×œ ×“×¨×™×™×‘ - ××ª×•×§×Ÿ
            document.getElementById('new-drive-link').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('new-file-owner').focus();
                }
            });

            // Enter ×‘×©× ×‘×¢×œ ×”×§×•×‘×¥ - ×—×“×©
            document.getElementById('new-file-owner').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addSubTopic();
                }
            });

            // Enter ×‘×¡×™×¡××ª ×× ×”×œ
            document.getElementById('admin-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });
			// Enter ×‘×©×“×•×ª ×©×™× ×•×™ ×¡×™×¡××”
            document.getElementById('current-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('new-password').focus();
                }
            });
            
            document.getElementById('new-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirm-password').focus();
                }
            });
            
            document.getElementById('confirm-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    changeAdminPassword();
                }
            });
        });
// ×¤×•× ×§×¦×™×” ×œ×©×™× ×•×™ ×¡×™×¡××ª ×× ×”×œ
        async function changeAdminPassword() {
            const currentPasswordInput = document.getElementById('current-password');
            const newPasswordInput = document.getElementById('new-password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const changeBtn = document.getElementById('change-password-btn');
            const errorDiv = document.getElementById('password-change-error');
            const successDiv = document.getElementById('password-change-success');
            
            // × ×§×” ×”×•×“×¢×•×ª ×§×•×“××•×ª
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            const currentPassword = currentPasswordInput.value.trim();
            const newPassword = newPasswordInput.value.trim();
            const confirmPassword = confirmPasswordInput.value.trim();
            
            // ×‘×“×™×§×•×ª ×ª×§×™× ×•×ª
            if (!currentPassword || !newPassword || !confirmPassword) {
                showPasswordError('×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }
            
            if (newPassword.length < 6) {
                showPasswordError('×”×¡×™×¡××” ×”×—×“×©×” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showPasswordError('×”×¡×™×¡××” ×”×—×“×©×” ×•××™××•×“ ×”×¡×™×¡××” ×œ× ×ª×•×××™×');
                return;
            }
            
            if (newPassword === currentPassword) {
                showPasswordError('×”×¡×™×¡××” ×”×—×“×©×” ×—×™×™×‘×ª ×œ×”×™×•×ª ×©×•× ×” ××”× ×•×›×—×™×ª');
                return;
            }
            
            changeBtn.disabled = true;
            changeBtn.textContent = '××©× ×” ×¡×™×¡××”...';
            
            try {
                if (!firebaseInitialized) {
                    showPasswordError('×©×’×™××”: ××¢×¨×›×ª ×œ× ××—×•×‘×¨×ª ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×');
                    return;
                }
                
                // ×‘×“×•×§ ××ª ×”×¡×™×¡××” ×”× ×•×›×—×™×ª
                const snapshot = await database.ref('adminPassword').once('value');
                if (!snapshot.exists()) {
                    showPasswordError('×©×’×™××”: ×œ× × ××¦××” ×¡×™×¡××ª ×× ×”×œ');
                    return;
                }
                
                const storedHash = snapshot.val();
                const currentPasswordHash = await hashPassword(currentPassword);
                
                if (storedHash !== currentPasswordHash) {
                    showPasswordError('×”×¡×™×¡××” ×”× ×•×›×—×™×ª ×©×’×•×™×”');
                    return;
                }
                
                // ×”×¦×¤×Ÿ ×•×©××•×¨ ××ª ×”×¡×™×¡××” ×”×—×“×©×”
                const newPasswordHash = await hashPassword(newPassword);
                await database.ref('adminPassword').set(newPasswordHash);
                
                // × ×§×” ××ª ×”×©×“×•×ª
                currentPasswordInput.value = '';
                newPasswordInput.value = '';
                confirmPasswordInput.value = '';
                
                showPasswordSuccess('×”×¡×™×¡××” ×©×•× ×ª×” ×‘×”×¦×œ×—×”! ğŸ‰');
                console.log('×¡×™×¡××ª ×”×× ×”×œ ×©×•× ×ª×” ×‘×”×¦×œ×—×”');
                
            } catch (error) {
                console.error('×©×’×™××” ×‘×©×™× ×•×™ ×¡×™×¡××”:', error);
                showPasswordError('×©×’×™××” ×‘×©×™× ×•×™ ×”×¡×™×¡××”. ×× × × ×¡×” ×©×•×‘.');
            } finally {
                changeBtn.disabled = false;
                changeBtn.textContent = '×©× ×” ×¡×™×¡××”';
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×”×¦×’×ª ×”×•×“×¢×•×ª
        function showPasswordError(message) {
            const errorDiv = document.getElementById('password-change-error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        }

        function showPasswordSuccess(message) {
            const successDiv = document.getElementById('password-change-success');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 5000);
            }
        }
        // ××ª×—×•×œ ×”××ª×¨
        initApp();
    </script>
</body>
</html>